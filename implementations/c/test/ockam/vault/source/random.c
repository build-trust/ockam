/**
 ********************************************************************************************************
 * @file    random.c
 * @brief   Ockam Vault common tests for random
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                             INCLUDE FILES                                            *
 ********************************************************************************************************
 */

#include <stdarg.h>
#include <stddef.h>
#include <setjmp.h>
#include <cmocka.h>

#include <ockam/error.h>
#include <ockam/log.h>
#include <ockam/vault.h>
#include <ockam/memory.h>

#include <test_vault.h>


/*
 ********************************************************************************************************
 *                                                DEFINES                                               *
 ********************************************************************************************************
 */

#define TEST_VAULT_RAND_NUM_SIZE                    32u         /*!< Size of the random number to generate            */


/*
 ********************************************************************************************************
 *                                               CONSTANTS                                              *
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                               DATA TYPES                                             *
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                          FUNCTION PROTOTYPES                                         *
 ********************************************************************************************************
 */

void test_vault_random(void **state);


/*
 ********************************************************************************************************
 *                                            GLOBAL VARIABLES                                          *
 ********************************************************************************************************
 */

uint8_t g_rand_num[TEST_VAULT_RAND_NUM_SIZE] = {0};


/*
 ********************************************************************************************************
 *                                           GLOBAL FUNCTIONS                                           *
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                            LOCAL FUNCTIONS                                           *
 ********************************************************************************************************
 */


/**
 ********************************************************************************************************
 *                                          test_vault_random()
 *
 * @brief   Ensure the specified ockam vault random function can generate a number
 *
 * @param   state   Shared variable between all test cases. Unused here.
 *
 ********************************************************************************************************
 */

void test_vault_random(void **state)
{
    OCKAM_ERR err = OCKAM_ERR_NONE;


    err = ockam_vault_random((uint8_t*) &g_rand_num,            /* Generate a random number                           */
                             TEST_VAULT_RAND_NUM_SIZE);
    assert_int_equal(err, OCKAM_ERR_NONE);
}


/**
 ********************************************************************************************************
 *                                          test_vault_run_random()
 *
 * @brief   Triggers the unit test for random number generation.
 *
 * @return  Zero on success. Non-zero on failure.
 *
 ********************************************************************************************************
 */

int test_vault_run_random(void)
{
    const struct CMUnitTest tests[] = {
        cmocka_unit_test(test_vault_random),
    };

    return cmocka_run_group_tests_name("RANDOM",
                                       tests,
                                       0,
                                       0);
}

