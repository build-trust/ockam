/**
********************************************************************************************************
 * @file        test_atecc508a.c
 * @brief
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                             INCLUDE FILES                                            *
 ********************************************************************************************************
 */

#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>

#include <stdarg.h>
#include <stddef.h>
#include <setjmp.h>
#include <cmocka.h>

#include <ockam/define.h>
#include <ockam/error.h>
#include <ockam/vault.h>

#include <test_vault.h>


/*
 ********************************************************************************************************
 *                                                DEFINES                                               *
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                               CONSTANTS                                              *
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                               DATA TYPES                                             *
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                          FUNCTION PROTOTYPES                                         *
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                            GLOBAL VARIABLES                                          *
 ********************************************************************************************************
 */

OCKAM_VAULT_CFG_s vault_cfg =
{
    .p_tpm                       = 0,
    .p_host                      = 0,
    OCKAM_VAULT_EC_CURVE25519
};


/*
 ********************************************************************************************************
 *                                           GLOBAL FUNCTIONS                                           *
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                            LOCAL FUNCTIONS                                           *
 ********************************************************************************************************
 */


/**
 ********************************************************************************************************
 *                                             main()
 *
 * @brief   Main point of entry for mbedcrypto test
 *
 ********************************************************************************************************
 */

int main (void)
{
    OCKAM_ERR err;
    uint8_t i;


    cmocka_set_message_output(CM_OUTPUT_XML);                   /* Configure the unit test output for JUnit XML       */

    /* ---------- */
    /* Vault Init */
    /* ---------- */

    err = ockam_vault_init((void*) &vault_cfg);                 /* Initialize vault                                   */

    if(err != OCKAM_ERR_NONE) {                                 /* Ensure it initialized before proceeding, otherwise */
        return -1;                                              /* don't bother trying to run any other tests         */
    }

    /* ------------------------ */
    /* Random Number Generation */
    /* ------------------------ */

    test_vault_run_random();

    /* --------------------- */
    /* Key Generation & ECDH */
    /* --------------------- */

    test_vault_run_key_ecdh(vault_cfg.ec, 1);

    /* ------ */
    /* SHA256 */
    /* ------ */

    test_vault_run_sha256();

    /* -----*/
    /* HKDF */
    /* -----*/

    test_vault_run_hkdf();

    /* -------------------- */
    /* AES GCM Calculations */
    /* -------------------- */

    test_vault_run_aes_gcm();

    return 0;
}

