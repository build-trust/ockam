name: Update Nix flake.lock
on:
  workflow_dispatch:
  schedule:
    # weekly on Sunday at 2:05am UTC
    # https://crontab.guru/#5_2_*_*_0
    - cron: '5 2 * * 0'

permissions:
  contents: write
  pull-requests: write

jobs:
  lockfile:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@3df4ab11eba7bda6032a0b82a6bb43b11571feac
      - name: Install Nix
        # https://github.com/DeterminateSystems/nix-installer-action/releases/tag/v4
        uses: DeterminateSystems/nix-installer-action@65d7c888b2778e8cf30a07a88422ccb23499bfb8
      - name: Update flake.lock
        # https://github.com/DeterminateSystems/update-flake-lock/releases/tag/v19
        uses: DeterminateSystems/update-flake-lock@da2fd6f2563fe3e4f2af8be73b864088564e263d
        with:
          git-author-name: 'ockam[bot]'
          git-author-email: 'ockam[bot]@users.noreply.ockam.io'
          git-committer-name: 'ockam[bot]'
          git-committer-email: 'ockam[bot]@users.noreply.ockam.io'
          path-to-flake-dir: 'tools/nix'
          pr-title: 'chore: Update tools/nix/flake.lock'
